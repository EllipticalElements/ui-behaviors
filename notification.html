<script>
    (function (root, factory) {
        root.Elliptical.Behaviors=root.Elliptical.Behaviors || {};
        root.Elliptical.Behaviors.Notification=factory();
    }(this, function () {


        return {
            /**
             *
             * @private
             */
            _initNotification:function () {
                this._data.set('notificationSelector','[notify-id="' + this.uuid + '"]');
                this._data.set('notificationElement','<ui-notification data-notify-id="' + this.uuid + '"></ui-notification>');
                var notification=$(this._data.get('notificationSelector'));
                if(!notification[0]){
                    var element = this.element;
                    var div=$(this._data.get('notificationElement'));
                    div.addClass(this.cssClass);
                    element.append(div);
                    if(this.top){
                        div.css({
                            top:this.top
                        })
                    }
                    this._data.set('element',div);
                }
                if(this.showOnInit){
                    this._show(this._data.get('element'));
                }
            },

            /**
             *
             * @private
             */
            _show: function(element){
                var self=this;
                var isVisible=this._data.get('isVisible');
                /* if terminate, setTimeout to display notification */
                if(this.terminate && isVisible){
                    setTimeout(function(){
                        self._showNotification(element);
                    },self.options.terminateDelay);
                }else{
                    /* else, show notification immediately */
                    this._showNotification(element);
                }
            },

            /**
             *
             * @private
             */
            _showNotification: function(element){
                var self=this;
                element.html(this.message);
                var newCssClass=this.cssClass;
                var oldCssClass=this._data.get('cssClass');
                if(newCssClass.toLowerCase()!==oldCssClass.toLowerCase()){
                    /* remove previously added classes */
                    element.removeClass(oldCssClass);
                    element.addClass(newCssClass);
                    this._data.set('cssClass',newCssClass);
                }
                element.addClass('visible');
                this._data.set('isVisible',true);
                /* if terminate, setTimeout to animateOut */
                if(this.terminate){
                    setTimeout(function(){
                        self._animateOut(element);
                    },self.options.terminateTimeout);
                }
            },

            /**
             *
             * @private
             */
            _hide: function(element){
                this._animateOut(element);
            },


            /**
             *
             * @param element
             * @private
             */
            _animateOut:function(element){
                var duration=this.animationDuration;
                this._data.set('isVisible',false);
                this._transition(element,{
                    opacity: 0,
                    duration:duration
                },function(){
                    element.removeClass('visible');
                    element.removeAttr('style');
                });
            },


            /**
             *
             * @private
             */
            _dispose:function(){
                var element = this._data.get('element');
                if(element[0]) element.remove();
            },


            /*==========================================
             PUBLIC METHODS
             *===========================================*/

            /**
             * @public
             */
            show:function (message,cssClass,terminate) {
                if(message===undefined) this.message='Processing';
                else this.message=message;

                if(cssClass!==undefined){
                    if(typeof cssClass==='boolean') this.terminate=cssClass;
                    else this.cssClass=cssClass;
                }

                if(terminate !==undefined) this.terminate=terminate;
                else this.terminate=true;

                var element=this._data.get('element');
                this._show(element);
            },

            /**
             * @public
             */
            hide:function () {
                var element=this._data.get('element');
                this._hide(element);
            }

        };
    }));
</script>